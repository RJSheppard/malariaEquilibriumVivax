
<!-- README.md is generated from README.Rmd. Please edit that file -->

# malariaEquilibriumVivax

[![Travis build
status](https://travis-ci.org/mrc-ide/malariaEquilibriumVivax.svg?branch=master)](https://travis-ci.org/mrc-ide/malariaEquilibriumVivax)
[![AppVeyor build
status](https://ci.appveyor.com/api/projects/status/github/mrc-ide/malariaEquilibriumVivax?branch=master&svg=true)](https://ci.appveyor.com/project/mrc-ide/malariaEquilibriumVivax)

Often we are interested in the state of a given malaria transmission
model at equilibrium. However, some models (e.g. the Griffin et al. 2014
model, the White et al. 2018 model) are quite complex, and can result in
equilibrium solutions that are fairly in-depth. In these situations it
is useful to have a “canonical” equilibrium solution that is tried and
tested, and can be used reliably by multiple users. This package
complements the malariaEquilibrium package to store canonical
equilibrium solutions for Plasmodium vivax malaria models.

## How to interact with this repos

If you have a new model with an equilibrium solution that you would like
to host here, then please go ahead and do so *in a new branch*. The
master branch, on the other hand, should always correspond to the
current most active model used by the malaria group (currently the White
et al. 2018 model). This should generally be left alone unless you know
what you’re doing.

Any changes that you propose to branches that you did not create
yourself (e.g. the master branch) should be done through pull requests,
rather than editing directly. This gives others the opportunity to
review your changes before they are implemented in code.

NB. These stipulations are in place because there are other R packages
that test against the equilibrium solutions from this package, and so
any changes here may cause other packages to fail if they are not know
about beforehand.

## Installation

You can install from the master branch of malariaEquilibriumVivax with:

``` r
# install.packages("devtools")
devtools::install_github("mrc-ide/malariaEquilibriumVivax")
```

Or from a specific branch with:

``` r
# install.packages("devtools")
devtools::install_github("mrc-ide/malariaEquilibriumVivax", ref = "mybranch")
```

Finally, don’t forget to load the package with:

``` r
library(malariaEquilibriumVivax)
library(malariasimulation)
```

## Example

### Working with parameters

It’s possibly easiest to begin with the default vivax parameter set as
found in malariasimulation.

``` r
vivax_params <- get_parameters(parasite = "vivax")
```

We can modify parameter values exactly as we would with a named list:

``` r
vivax_params$eta <- 0.1
head(vivax_params)
#> $dd
#> [1] 5
#> 
#> $dt
#> [1] 1
#> 
#> $da
#> [1] 10
#> 
#> $dpcr_max
#> [1] 70
#> 
#> $dpcr_min
#> [1] 10
#> 
#> $kpcr
#> [1] 4.602
```

These do not have parameter names that are consistent with Michael
White’s model and must be translated for use in the equilibrium
solution.

``` r
vivax_eq_params <- malariasimulation:::translate_vivax_parameters(vivax_params)
```

### Getting the equilibrium solution

Now we can calculate the equilibrium solution using the
`vivax_equilibrium()` function. This assumes a fixed EIR and treatment
rate (`ft`), and takes model parameters as input. It calculates the
equilibrium solution for a defined age range:

``` r
eq <- vivax_equilibrium(EIR = 10, ft = 0.2, p = vivax_eq_params, age = 0:10)
```

We have two equilibrium solutions: a full solution that loops over
hypnozoite batch numbers until reaching a limit (the default limit is
set to 10 hypnozoite batches), and a simplified, approximate, version
that calculates the average for each age and biting heterogeneity group.

``` r
eq <- vivax_equilibrium(EIR = 10, ft = 0.2, p = vivax_eq_params, age = 0:10, v_eq = "simplified")
```

The output elements are “states” and “FOIM”. The former is a matrix with
age brackets in rows, and model states or other downstream calculations
in columns. For example, the column “S” gives the equilibrium proportion
of humans in the susceptible state.

``` r
head(eq$states)
#> [[1]]
#>    age       prop            S            U            A            D
#> 1    0 0.04347126 8.761186e-05 0.0001821670 1.778841e-04 2.704346e-05
#> 2    1 0.04158151 8.125013e-05 0.0001506895 2.141042e-04 1.417579e-05
#> 3    2 0.03977391 6.917851e-05 0.0001696545 1.952529e-04 8.791530e-06
#> 4    3 0.03804489 6.131761e-05 0.0001909988 1.654373e-04 6.787005e-06
#> 5    4 0.03639103 5.552787e-05 0.0002068250 1.384096e-04 5.742089e-06
#> 6    5 0.03480906 5.073966e-05 0.0002167239 1.165638e-04 5.050992e-06
#> 7    6 0.03329587 4.662103e-05 0.0002217941 9.938515e-05 4.530718e-06
#> 8    7 0.03184846 4.303134e-05 0.0002232539 8.587058e-05 4.111977e-06
#> 9    8 0.03046396 4.355449e-05 0.0002586391 3.774757e-05 1.928333e-06
#> 10   9 0.67032005 9.437033e-04 0.0059137907 6.365549e-04 3.355882e-05
#>               T            P        ID          IDM        ICA          ICM
#> 1  1.367281e-06 1.330026e-05  10.57063 3.998968e-01   18.34678 2.714350e+00
#> 2  7.022980e-07 7.178265e-06  22.33676 1.235799e-05   43.05848 8.388141e-05
#> 3  4.368955e-07 4.436999e-06  34.00066 3.818982e-10   70.75929 2.592182e-09
#> 4  3.384367e-07 3.407793e-06  45.14801 1.180178e-14   99.90119 8.010607e-14
#> 5  2.866831e-07 2.877534e-06  55.62886 3.647096e-19  129.66663 2.475513e-18
#> 6  2.523018e-07 2.529270e-06  65.39694 1.127060e-23  159.58217 7.650064e-23
#> 7  2.263673e-07 2.267914e-06  74.45270 3.482947e-28  189.35599 2.364095e-27
#> 8  2.054745e-07 2.057867e-06  82.81917 1.076333e-32  218.80051 7.305749e-32
#> 9  9.529628e-08 9.806310e-07 143.29850 3.326186e-37  617.55668 2.257691e-36
#> 10 1.677722e-06 1.678306e-05 170.87002 1.027889e-41 1159.80212 6.976931e-41
#>           HH EIR       inf       E_M       I_M  inf_rvoir      mv0       psi
#> 1   3.093588  10 0.3404829 0.4828513 0.2377735 0.01254184 258.7219 0.3090514
#> 2   6.138467  10 0.3404829 0.4828513 0.2377735 0.02794163 258.7219 0.4529588
#> 3   8.988822  10 0.3404829 0.4828513 0.2377735 0.04860308 258.7219 0.5799565
#> 4  11.588919  10 0.3404829 0.4828513 0.2377735 0.07346903 258.7219 0.6920317
#> 5  13.927406  10 0.3404829 0.4828513 0.2377735 0.10152487 258.7219 0.7909376
#> 6  16.013886  10 0.3404829 0.4828513 0.2377735 0.13200393 258.7219 0.8782218
#> 7  17.867008  10 0.3404829 0.4828513 0.2377735 0.16433115 258.7219 0.9552499
#> 8  19.508507  10 0.3404829 0.4828513 0.2377735 0.19807861 258.7219 1.0232269
#> 9  22.389442  10 0.3404829 0.4828513 0.2377735 0.23003966 258.7219 1.0832164
#> 10 23.625208  10 0.3404829 0.4828513 0.2377735 0.01146621 258.7219 1.1361569
#>      phi_clin phi_patent       dPCR
#> 1  0.19089373 0.80421382 0.03026526
#> 2  0.05938605 0.55712315 0.08782813
#> 3  0.03199827 0.33758023 0.09799606
#> 4  0.02450078 0.21122928 0.09944715
#> 5  0.02162766 0.14224636 0.09978762
#> 6  0.02027758 0.10271528 0.09989899
#> 7  0.01955126 0.07855151 0.09994436
#> 8  0.01912118 0.06288163 0.09996591
#> 9  0.01810871 0.02076750 0.09999726
#> 10 0.01802633 0.01515468 0.09999878
#> 
#> [[2]]
#>    age       prop            S           U           A            D
#> 1    0 0.04347126 2.613294e-04 0.001303464 0.006205542 0.0012212279
#> 2    1 0.04158151 1.426324e-04 0.001250322 0.006299085 0.0009942755
#> 3    2 0.03977391 1.124628e-04 0.001462042 0.005765795 0.0009629618
#> 4    3 0.03804489 9.859092e-05 0.001681083 0.005156678 0.0009760797
#> 5    4 0.03639103 8.963806e-05 0.001862050 0.004604754 0.0009842103
#> 6    5 0.03480906 8.274156e-05 0.001997691 0.004130453 0.0009804370
#> 7    6 0.03329587 7.697945e-05 0.002091711 0.003727876 0.0009663686
#> 8    7 0.03184846 7.197452e-05 0.002150617 0.003385836 0.0009448453
#> 9    8 0.03046396 8.927242e-05 0.003354386 0.002244104 0.0006941650
#> 10   9 0.67032005 2.037914e-03 0.082167441 0.043057389 0.0139346452
#>               T            P        ID          IDM        ICA          ICM
#> 1  6.174363e-05 0.0006006128  15.23206 4.271442e-01   36.66457 3.172183e+00
#> 2  4.961847e-05 0.0004983187  29.65655 1.320001e-05   75.30948 9.802978e-05
#> 3  4.815449e-05 0.0004814117  42.99343 4.079193e-10  113.93689 3.029409e-09
#> 4  4.883472e-05 0.0004875880  55.24173 1.260591e-14  151.96757 9.361764e-14
#> 5  4.923884e-05 0.0004916801  66.45799 3.895596e-19  189.17293 2.893061e-18
#> 6  4.904372e-05 0.0004898887  76.71376 1.203854e-23  225.45180 8.940409e-23
#> 7  4.833444e-05 0.0004829424  86.08292 3.720262e-28  260.75986 2.762849e-27
#> 8  4.725375e-05 0.0004722490  94.63723 1.149670e-32  295.08158 8.538017e-32
#> 9  3.459118e-05 0.0003487948 155.39515 3.552820e-37  748.61963 2.638499e-36
#> 10 6.966993e-04 0.0069678541 182.51247 1.097926e-41 1355.42721 8.153737e-41
#>           HH EIR       inf       E_M       I_M  inf_rvoir      mv0       psi
#> 1   21.53103  10 0.3404829 0.4828513 0.2377735 0.01254184 258.7219 0.3090514
#> 2   42.72306  10 0.3404829 0.4828513 0.2377735 0.02794163 258.7219 0.4529588
#> 3   62.56122  10 0.3404829 0.4828513 0.2377735 0.04860308 258.7219 0.5799565
#> 4   80.65761  10 0.3404829 0.4828513 0.2377735 0.07346903 258.7219 0.6920317
#> 5   96.93323  10 0.3404829 0.4828513 0.2377735 0.10152487 258.7219 0.7909376
#> 6  111.45490  10 0.3404829 0.4828513 0.2377735 0.13200393 258.7219 0.8782218
#> 7  124.35243  10 0.3404829 0.4828513 0.2377735 0.16433115 258.7219 0.9552499
#> 8  135.77708  10 0.3404829 0.4828513 0.2377735 0.19807861 258.7219 1.0232269
#> 9  155.82807  10 0.3404829 0.4828513 0.2377735 0.23003966 258.7219 1.0832164
#> 10 164.42888  10 0.3404829 0.4828513 0.2377735 0.01146621 258.7219 1.1361569
#>      phi_clin phi_patent       dPCR
#> 1  0.06684145 0.70996903 0.06065394
#> 2  0.03019324 0.40825898 0.09631628
#> 3  0.02284578 0.23047217 0.09930876
#> 4  0.02054163 0.14421445 0.09978070
#> 5  0.01955464 0.09937895 0.09990619
#> 6  0.01904822 0.07380041 0.09995151
#> 7  0.01875584 0.05799613 0.09997146
#> 8  0.01857240 0.04758888 0.09998154
#> 9  0.01807051 0.01789600 0.09999812
#> 10 0.01801854 0.01358003 0.09999910
#> 
#> [[3]]
#>    age       prop            S            U           A           D
#> 1    0 0.04347126 1.356852e-04 0.0004490222 0.010032334 0.008148264
#> 2    1 0.04158151 6.166422e-05 0.0004557116 0.009857009 0.007614620
#> 3    2 0.03977391 4.417876e-05 0.0005446475 0.008718366 0.007682977
#> 4    3 0.03804489 3.570976e-05 0.0006334018 0.007557549 0.007785391
#> 5    4 0.03639103 3.041535e-05 0.0007099122 0.006597192 0.007789504
#> 6    5 0.03480906 2.667210e-05 0.0007717204 0.005826852 0.007704254
#> 7    6 0.03329587 2.383568e-05 0.0008193035 0.005205543 0.007555217
#> 8    7 0.03184846 2.158723e-05 0.0008540905 0.004697144 0.007363940
#> 9    8 0.03046396 2.149230e-05 0.0017239522 0.003918674 0.006826905
#> 10   9 0.67032005 4.754731e-04 0.0456116594 0.081133902 0.148569281
#>               T           P        ID          IDM        ICA          ICM
#> 1  0.0004119652 0.004007402  16.22430 4.312190e-01   42.55730 3.248164e+00
#> 2  0.0003806429 0.003807158  31.10813 1.332594e-05   84.45729 1.003778e-04
#> 3  0.0003843717 0.003838211  44.70219 4.118107e-10  125.27467 3.101971e-09
#> 4  0.0003895139 0.003889042  57.10311 1.272616e-14  164.92329 9.586002e-14
#> 5  0.0003896672 0.003891858  68.40980 3.932758e-19  203.39098 2.962357e-18
#> 6  0.0003853548 0.003849982  78.71605 1.215338e-23  240.69041 9.154554e-23
#> 7  0.0003778651 0.003776034  88.10889 3.755752e-28  276.84448 2.829026e-27
#> 8  0.0003682739 0.003680808  96.66840 1.160638e-32  311.88066 8.742524e-32
#> 9  0.0003412243 0.003415200 157.29035 3.586713e-37  772.86571 2.701697e-36
#> 10 0.0074284236 0.074285285 184.25357 1.108400e-41 1387.89304 8.349039e-41
#>          HH EIR       inf       E_M       I_M  inf_rvoir      mv0       psi
#> 1  124.1326  10 0.3404829 0.4828513 0.2377735 0.01254184 258.7219 0.3090514
#> 2  246.3107  10 0.3404829 0.4828513 0.2377735 0.02794163 258.7219 0.4529588
#> 3  360.6834  10 0.3404829 0.4828513 0.2377735 0.04860308 258.7219 0.5799565
#> 4  465.0143  10 0.3404829 0.4828513 0.2377735 0.07346903 258.7219 0.6920317
#> 5  558.8480  10 0.3404829 0.4828513 0.2377735 0.10152487 258.7219 0.7909376
#> 6  642.5696  10 0.3404829 0.4828513 0.2377735 0.13200393 258.7219 0.8782218
#> 7  716.9276  10 0.3404829 0.4828513 0.2377735 0.16433115 258.7219 0.9552499
#> 8  782.7940  10 0.3404829 0.4828513 0.2377735 0.19807861 258.7219 1.0232269
#> 9  898.3937  10 0.3404829 0.4828513 0.2377735 0.23003966 258.7219 1.0832164
#> 10 947.9798  10 0.3404829 0.4828513 0.2377735 0.01146621 258.7219 1.1361569
#>      phi_clin phi_patent       dPCR
#> 1  0.05424133 0.68758246 0.06658711
#> 2  0.02745211 0.38312204 0.09701818
#> 3  0.02191874 0.21504055 0.09942149
#> 4  0.02011537 0.13507527 0.09981165
#> 5  0.01932110 0.09362869 0.09991788
#> 6  0.01890493 0.06993321 0.09995693
#> 7  0.01866068 0.05524223 0.09997436
#> 8  0.01850539 0.04553369 0.09998326
#> 9  0.01806563 0.01751116 0.09999822
#> 10 0.01801758 0.01337267 0.09999914
#> 
#> [[4]]
#>    age       prop            S            U            A           D
#> 1    0 0.04347126 1.404584e-05 1.502452e-05 0.0012350492 0.005439554
#> 2    1 0.04158151 6.549001e-06 1.856366e-05 0.0011946361 0.005171183
#> 3    2 0.03977391 4.443058e-06 2.455780e-05 0.0010051769 0.005031822
#> 4    3 0.03804489 3.391921e-06 3.023979e-05 0.0008317184 0.004892987
#> 5    4 0.03639103 2.755720e-06 3.522884e-05 0.0007008685 0.004737530
#> 6    5 0.03480906 2.327239e-06 3.941659e-05 0.0006031289 0.004571418
#> 7    6 0.03329587 2.017988e-06 4.280616e-05 0.0005284996 0.004400716
#> 8    7 0.03184846 1.783518e-06 4.545051e-05 0.0004699808 0.004229497
#> 9    8 0.03046396 1.537001e-06 9.916977e-05 0.0004037265 0.004039248
#> 10   9 0.67032005 3.240566e-05 2.693804e-03 0.0084422980 0.088834463
#>               T           P        ID          IDM        ICA          ICM
#> 1  0.0002750165 0.002675230  16.40971 4.319337e-01   43.77771 3.261716e+00
#> 2  0.0002585495 0.002584771  31.37592 1.334802e-05   86.29751 1.007966e-04
#> 3  0.0002516388 0.002515189  45.01507 4.124932e-10  127.51756 3.114912e-09
#> 4  0.0002446941 0.002445822  57.44218 1.274725e-14  167.45734 9.625994e-14
#> 5  0.0002369086 0.002368280  68.76394 3.939276e-19  206.14855 2.974715e-18
#> 6  0.0002285932 0.002285371  79.07819 1.217352e-23  243.62626 9.192746e-23
#> 7  0.0002200515 0.002200120  88.47433 3.761977e-28  279.92632 2.840829e-27
#> 8  0.0002114861 0.002114578  97.03392 1.162562e-32  315.08439 8.778997e-32
#> 9  0.0002019589 0.002019672 157.62575 3.592657e-37  777.31251 2.712968e-36
#> 10 0.0044417221 0.044417249 184.55895 1.110237e-41 1393.68324 8.383871e-41
#>           HH EIR       inf       E_M       I_M  inf_rvoir      mv0       psi
#> 1   715.6602  10 0.3404829 0.4828513 0.2377735 0.01254184 258.7219 0.3090514
#> 2  1420.0524  10 0.3404829 0.4828513 0.2377735 0.02794163 258.7219 0.4529588
#> 3  2079.4439  10 0.3404829 0.4828513 0.2377735 0.04860308 258.7219 0.5799565
#> 4  2680.9416  10 0.3404829 0.4828513 0.2377735 0.07346903 258.7219 0.6920317
#> 5  3221.9194  10 0.3404829 0.4828513 0.2377735 0.10152487 258.7219 0.7909376
#> 6  3704.5988  10 0.3404829 0.4828513 0.2377735 0.13200393 258.7219 0.8782218
#> 7  4133.2938  10 0.3404829 0.4828513 0.2377735 0.16433115 258.7219 0.9552499
#> 8  4513.0328  10 0.3404829 0.4828513 0.2377735 0.19807861 258.7219 1.0232269
#> 9  5179.4985  10 0.3404829 0.4828513 0.2377735 0.23003966 258.7219 1.0832164
#> 10 5465.3766  10 0.3404829 0.4828513 0.2377735 0.01146621 258.7219 1.1361569
#>      phi_clin phi_patent       dPCR
#> 1  0.05222273 0.68335001 0.06762373
#> 2  0.02700943 0.37865297 0.09712966
#> 3  0.02176604 0.21235675 0.09943965
#> 4  0.02004420 0.13349559 0.09981670
#> 5  0.01928173 0.09263600 0.09991981
#> 6  0.01888060 0.06926541 0.09995783
#> 7  0.01864444 0.05476634 0.09997484
#> 8  0.01849391 0.04517828 0.09998355
#> 9  0.01806479 0.01744465 0.09999824
#> 10 0.01801742 0.01333697 0.09999915
#> 
#> [[5]]
#>    age       prop            S            U            A            D
#> 1    0 0.04347126 1.136745e-07 6.306568e-08 1.024354e-05 0.0003105311
#> 2    1 0.04158151 5.344050e-08 9.733665e-08 9.861017e-06 0.0002955733
#> 3    2 0.03977391 3.566446e-08 1.421729e-07 8.157806e-06 0.0002834986
#> 4    3 0.03804489 2.679287e-08 1.838911e-07 6.651135e-06 0.0002718908
#> 5    4 0.03639103 2.149840e-08 2.205086e-07 5.545382e-06 0.0002605712
#> 6    5 0.03480906 1.798497e-08 2.514445e-07 4.735910e-06 0.0002495854
#> 7    6 0.03329587 1.548168e-08 2.767464e-07 4.127023e-06 0.0002389729
#> 8    7 0.03184846 1.360420e-08 2.967733e-07 3.654993e-06 0.0002287530
#> 9    8 0.03046396 1.147078e-08 6.613133e-07 3.144114e-06 0.0002187925
#> 10   9 0.67032005 2.396842e-07 1.809383e-05 6.577405e-05 0.0048141683
#>               T            P        ID          IDM        ICA          ICM
#> 1  1.570003e-05 0.0001527225  16.44348 4.320624e-01   44.00447 3.264163e+00
#> 2  1.477831e-05 0.0001477368  31.42458 1.335200e-05   86.63754 1.008722e-04
#> 3  1.417536e-05 0.0001417417  45.07185 4.126161e-10  127.93070 3.117249e-09
#> 4  1.359494e-05 0.0001359394  57.50365 1.275105e-14  167.92312 9.633216e-14
#> 5  1.302884e-05 0.0001302814  68.82810 3.940450e-19  206.65461 2.976947e-18
#> 6  1.247946e-05 0.0001247898  79.14376 1.217715e-23  244.16437 9.199643e-23
#> 7  1.194878e-05 0.0001194844  88.54046 3.763098e-28  280.49062 2.842960e-27
#> 8  1.143774e-05 0.0001143751  97.10005 1.162908e-32  315.67049 8.785584e-32
#> 9  1.093962e-05 0.0001093964 157.68624 3.593728e-37  778.11997 2.715004e-36
#> 10 2.407084e-04 0.0024070842 184.61394 1.110568e-41 1394.72886 8.390161e-41
#>           HH EIR       inf       E_M       I_M  inf_rvoir      mv0       psi
#> 1   4980.917  10 0.3404829 0.4828513 0.2377735 0.01254184 258.7219 0.3090514
#> 2   9883.410  10 0.3404829 0.4828513 0.2377735 0.02794163 258.7219 0.4529588
#> 3  14472.703  10 0.3404829 0.4828513 0.2377735 0.04860308 258.7219 0.5799565
#> 4  18659.061  10 0.3404829 0.4828513 0.2377735 0.07346903 258.7219 0.6920317
#> 5  22424.208  10 0.3404829 0.4828513 0.2377735 0.10152487 258.7219 0.7909376
#> 6  25783.604  10 0.3404829 0.4828513 0.2377735 0.13200393 258.7219 0.8782218
#> 7  28767.274  10 0.3404829 0.4828513 0.2377735 0.16433115 258.7219 0.9552499
#> 8  31410.216  10 0.3404829 0.4828513 0.2377735 0.19807861 258.7219 1.0232269
#> 9  36048.745  10 0.3404829 0.4828513 0.2377735 0.23003966 258.7219 1.0832164
#> 10 38038.426  10 0.3404829 0.4828513 0.2377735 0.01146621 258.7219 1.1361569
#>      phi_clin phi_patent       dPCR
#> 1  0.05186544 0.68257778 0.06780994
#> 2  0.02693090 0.37784652 0.09714937
#> 3  0.02173886 0.21187429 0.09944287
#> 4  0.02003150 0.13321190 0.09981760
#> 5  0.01927469 0.09245775 0.09992015
#> 6  0.01887625 0.06914549 0.09995799
#> 7  0.01864153 0.05468088 0.09997493
#> 8  0.01849185 0.04511444 0.09998360
#> 9  0.01806464 0.01743271 0.09999824
#> 10 0.01801739 0.01333057 0.09999915
```

The “FOIM” element gives the onward force of infection from humans to
mosquitoes, which is a single number:

``` r
eq$FOIM
#> [1] 0.1423578
```
